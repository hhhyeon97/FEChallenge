<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>To-Do List</title>   
<link rel="stylesheet" href="style.css"> 
</head>
<body>
<h2>To-Do List</h2>
<div class="todo-container">
        <div>
            <button class="showBtn" onclick="showAllTasks()">전체</button>
            <button class="showBtn" onclick="showCompletedTasks()">해결</button>
            <button class="showBtn" onclick="showUncompletedTasks()">미해결</button>
        </div>
<div id="todoInput">
    <label for="priorityCheckbox">우선순위</label>
    <select id="priorityCheckbox" name="priority">
    <option value="1">낮음</option>
    <option value="2">보통</option>
    <option value="3">높음</option>
    <option value="4">아주 높음</option>
	</select>
<input type="text" id="taskInput" placeholder="할 일을 작성해보아요 !">
<button id="addBtn">추가</button>                 
</div>
<!-- ToDo 리스트 부분  -->
        <ul id="todoList"></ul>

<!--<button id="sortBtn">우선순위 정렬</button>-->
</div>
<script>

// deleteTask 함수를 밖으로 빼서 전역 함수로 정의
function deleteTask(listItem) {
    listItem.parentNode.removeChild(listItem);
}


// editTask 함수 추가
function editTask(listItem) {
    var taskText = listItem.lastChild.previousSibling.textContent;
    var priorityText = listItem.querySelector("strong").textContent;
    var priority = getPriorityValue(priorityText);

    // 수정 폼 생성
    var editForm = document.createElement("div");
    editForm.classList.add("edit-form");

    var editInput = document.createElement("input");
    editInput.type = "text";
    editInput.value = taskText;

    var saveButton = document.createElement("button");
    saveButton.textContent = "저장";
    saveButton.addEventListener("click", function () {
        saveTask(listItem, editInput, priority);
    });

    var cancelButton = document.createElement("button");
    cancelButton.textContent = "취소";
    cancelButton.addEventListener("click", function () {
        cancelEdit(listItem);
    });

    editForm.appendChild(editInput);
    editForm.appendChild(saveButton);
    editForm.appendChild(cancelButton);

    // 수정 폼 삽입
    listItem.appendChild(editForm);

    // 원래 내용 숨김
    listItem.firstChild.style.display = "none";
    listItem.lastChild.style.display = "none";
}

// saveTask 함수 추가
function saveTask(listItem, editInput, priority) {
    var newTaskText = editInput.value;

    // 수정된 내용으로 리스트 아이템 갱신
    listItem.firstChild.textContent = newTaskText;
    listItem.firstChild.style.display = ""; // 수정된 내용 보이게 함

    // 수정 폼 제거
    listItem.removeChild(listItem.lastChild);

    // 에딧 버튼과 삭제 버튼 보이게 함
    listItem.lastChild.style.display = "";
}

// cancelEdit 함수 추가
function cancelEdit(listItem) {
    // 에딧 폼 제거
    listItem.removeChild(listItem.lastChild);

    // 에딧 버튼과 삭제 버튼 보이게 함
    listItem.firstChild.style.display = "";
    listItem.lastChild.style.display = "";
}

document.getElementById("addBtn").addEventListener("click", function () {
            addTask();
        });

document.getElementById("sortBtn").addEventListener("click", function () {
    sortTasksByPriority();
});

function addTask() {
    // 입력 필드에서 할 일과 우선순위를 가져오기
    var taskInput = document.getElementById("taskInput");
    var priorityCheckbox = document.getElementById("priorityCheckbox");
    var task = taskInput.value;
    var priority = priorityCheckbox.value;

    if (task.trim() === "") {
        alert("할 일을 입력하세요!");
        return;
    }

    // 새로운 리스트 아이템 생성
   // var listItem = document.createElement("li");

    
    // 새로운 리스트 아이템 생성  수정 
    var listItem = createListItem(priority, task);
    
    
    // 우선순위 텍스트로 변경하여 보여주기
   //풀기 var priorityText = getPriorityText(priority);
    //listItem.innerHTML = "<strong>" + priorityText + "</strong>: " + task;
	// 풀기 listItem.innerHTML = "<strong class='priority-" + priority + "'>" + priorityText + "</strong>: " + task;
    
	// 할 일 목록에 추가
    document.getElementById("todoList").appendChild(listItem);

    // 입력 필드 초기화
    taskInput.value = "";
}

        function createListItem(priority, task) {
            var listItem = document.createElement("li");
            listItem.classList.add("priority-" + priority);

            var priorityText = getPriorityText(priority);
            listItem.innerHTML = "<strong class='priority-" + priority + "'>" + priorityText + "</strong>: " + task;

            var checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.addEventListener("change", function () {
                toggleCompleted(listItem, checkbox.checked);
            });

            

            var editButton = document.createElement("button");
            editButton.textContent = "수정";
            editButton.classList.add("edit-btn"); // 에딧 버튼에 클래스 추가
            editButton.addEventListener("click", function () {
                editTask(listItem);
            });

            var deleteButton = document.createElement("button");
            deleteButton.textContent = "삭제";
            deleteButton.classList.add("delete-btn"); // 삭제 버튼에 클래스 추가
            deleteButton.addEventListener("click", function () {
            	confirmDelete(deleteTask, listItem);
            });

            listItem.appendChild(checkbox);
            listItem.appendChild(editButton);
            listItem.appendChild(deleteButton);

            return listItem;
        }

        function toggleCompleted(listItem, completed) {
            if (completed) {
                listItem.classList.add("completed");
            } else {
                listItem.classList.remove("completed");
            }
        }

        function showAllTasks() {
            showTasksByStatus(null);
        }

        function showCompletedTasks() {
            showTasksByStatus(true);
        }

        function showUncompletedTasks() {
            showTasksByStatus(false);
        }

        function showTasksByStatus(completed) {
            var todoList = document.getElementById("todoList");
            var items = Array.from(todoList.children);

            items.forEach(function (item) {
                var isCompleted = item.classList.contains("completed");
                if (completed === null || isCompleted === completed) {
                    item.style.display = "block";
                } else {
                    item.style.display = "none";
                }
            });
        }


        function confirmDelete(callback, listItem) {
            var confirmDelete = confirm("정말 삭제하시겠습니까?");
            if (confirmDelete) {
                callback(listItem);
            }
        }
        
function getPriorityText(value) {
    switch (value) {
        case "1":
            return "낮음";
        case "2":
            return "보통";
        case "3":
            return "높음";
        case "4":
            return "아주 높음";
        default:
            return "";
    }
}
function getPriorityValue(text) {
    switch (text) {
        case "낮음":
            return 1;
        case "보통":
            return 2;
        case "높음":
            return 3;
        case "아주 높음":
            return 4;
        default:
            return 0;
    }
}
    </script>
</body>
</html>